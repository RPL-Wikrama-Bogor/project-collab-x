<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Laporan Aktivitas Web - GreenLeaf</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #2e7d32;
      --primary-light: #81c784;
      --primary-lighter: #e8f5e9;
      --dark-bg: #121212;
      --dark-text: #e0e0e0;
      --dark-card: #1e1e1e;
    }
    
    body {
      background-color: #f6fdf4;
      transition: all 0.3s ease;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body.dark-mode {
      background-color: var(--dark-bg);
      color: var(--dark-text);
    }
    
    h1, h2, h3 {
      color: var(--primary);
      font-weight: 600;
    }
    
    .dark-mode h1, 
    .dark-mode h2,
    .dark-mode h3 {
      color: var(--primary-light);
    }
    
    .section {
      margin-bottom: 40px;
      padding: 25px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      animation: fadeInUp 0.6s ease;
    }
    
    .dark-mode .section {
      background: var(--dark-card);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .navbar {
      background-color: var(--primary);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .navbar-brand {
      font-weight: 700;
      font-size: 1.5rem;
    }
    
    .table {
      background-color: white;
    }
    
    .dark-mode .table {
      background-color: var(--dark-card);
      color: var(--dark-text);
    }
    
    .dark-mode .table th {
      color: var(--primary-light);
    }
    
    canvas {
      max-width: 100%;
      height: 250px !important;
      margin: 15px 0;
    }
    
    .summary-card {
      text-align: center;
      padding: 20px;
      border-radius: 10px;
      background: var(--primary-lighter);
      transition: transform 0.3s;
    }
    
    .dark-mode .summary-card {
      background: #1a2e1a;
    }
    
    .summary-card:hover {
      transform: translateY(-5px);
    }
    
    .summary-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary);
    }
    
    .dark-mode .summary-number {
      color: var(--primary-light);
    }
    
    .summary-label {
      font-size: 1rem;
      color: #555;
    }
    
    .dark-mode .summary-label {
      color: #aaa;
    }
    
    .progress {
      height: 10px;
      margin: 10px 0;
    }
    
    .progress-bar {
      background-color: var(--primary);
    }
    
    .country-item {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      padding: 8px;
      background: var(--primary-lighter);
      border-radius: 5px;
    }
    
    .dark-mode .country-item {
      background: #1a2e1a;
    }
    
    .badge-traffic {
      background-color: var(--primary);
      font-size: 0.9rem;
    }
    
    footer {
      background-color: var(--primary-lighter);
      padding: 20px;
      margin-top: 40px;
    }
    
    .dark-mode footer {
      background-color: #1a2e1a;
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .summary-card {
        margin-bottom: 15px;
      }
      
      .section {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container">
      <a class="navbar-brand" href="#">
        <i class="fas fa-leaf me-2"></i>GreenLeaf Analytics
      </a>
      <div class="d-flex">
        <button class="btn btn-outline-light me-2" onclick="toggleDarkMode()">
          <i class="fas fa-moon"></i> Mode Gelap
        </button>
        <button class="btn btn-light" onclick="window.print()">
          <i class="fas fa-print"></i> Cetak
        </button>
      </div>
    </div>
  </nav>

  <div class="container mt-4" id="report-content">
    <!-- Header -->
    <div class="section text-center">
      <h1><i class="fas fa-chart-line text-success me-2"></i>Laporan Aktivitas Website</h1>
      <p class="lead">Periode: 1 Januari 2025 - 31 Maret 2025</p>
    </div>

    <!-- Filter Section -->
    <div class="section">
      <h3><i class="fas fa-filter me-2"></i>Filter Laporan</h3>
      <div class="row g-3">
        <div class="col-md-4">
          <label for="startDate" class="form-label">Tanggal Mulai</label>
          <input type="date" class="form-control" id="startDate" value="2025-01-01">
        </div>
        <div class="col-md-4">
          <label for="endDate" class="form-label">Tanggal Selesai</label>
          <input type="date" class="form-control" id="endDate" value="2025-03-31">
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button onclick="applyFilter()" class="btn btn-success w-100">
            <i class="fas fa-check me-1"></i> Terapkan
          </button>
        </div>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="section">
      <h3><i class="fas fa-chart-pie me-2"></i>Ringkasan Utama</h3>
      <div class="row mt-4">
        <div class="col-md-3">
          <div class="summary-card">
            <div class="summary-number" id="visitors">8.450</div>
            <div class="summary-label">Total Pengunjung</div>
            <small class="text-muted">+12% dari periode lalu</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="summary-card">
            <div class="summary-number" id="views">21.300</div>
            <div class="summary-label">Halaman Dilihat</div>
            <small class="text-muted">+8% dari periode lalu</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="summary-card">
            <div class="summary-number" id="duration">3:42</div>
            <div class="summary-label">Durasi Rata-rata</div>
            <small class="text-muted">+0:15 dari periode lalu</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="summary-card">
            <div class="summary-number" id="bounce">42%</div>
            <div class="summary-label">Rasio Pentalan</div>
            <small class="text-muted">-3% dari periode lalu</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Notification -->
    <div class="alert alert-success d-flex align-items-center">
      <i class="fas fa-rocket me-3 fs-4"></i>
      <div>
        <strong>Peningkatan Trafik!</strong> Kemarin terjadi lonjakan pengunjung sebesar 35% dibandingkan hari biasa.
      </div>
    </div>

    <!-- Charts Row -->
    <div class="row">
      <div class="col-md-6">
        <div class="section">
          <h3><i class="fas fa-users me-2"></i>Pengunjung Baru vs Kembali</h3>
          <canvas id="visitorChart"></canvas>
          <div class="text-center mt-2">
            <button class="btn btn-sm btn-outline-success me-2" onclick="changeChartType('visitorChart', 'doughnut')">
              <i class="fas fa-chart-pie"></i> Pie
            </button>
            <button class="btn btn-sm btn-outline-success" onclick="changeChartType('visitorChart', 'bar')">
              <i class="fas fa-chart-bar"></i> Bar
            </button>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="section">
          <h3><i class="fas fa-calendar-day me-2"></i>Pengunjung Harian</h3>
          <canvas id="dailyChart"></canvas>
          <div class="text-center mt-2">
            <button class="btn btn-sm btn-outline-success me-2" onclick="changeChartType('dailyChart', 'bar')">
              <i class="fas fa-chart-bar"></i> Bar
            </button>
            <button class="btn btn-sm btn-outline-success" onclick="changeChartType('dailyChart', 'line')">
              <i class="fas fa-chart-line"></i> Line
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Pages -->
    <div class="section">
      <h3><i class="fas fa-file-alt me-2"></i>Halaman Terpopuler</h3>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="table-success">
            <tr>
              <th>#</th>
              <th>Halaman</th>
              <th>Kunjungan</th>
              <th>% dari Total</th>
              <th>Durasi Rata-rata</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>/beranda</td>
              <td>4.500</td>
              <td>
                <div class="progress">
                  <div class="progress-bar" style="width: 53%">53%</div>
                </div>
              </td>
              <td>2m 10d</td>
            </tr>
            <tr>
              <td>2</td>
              <td>/tentang</td>
              <td>2.100</td>
              <td>
                <div class="progress">
                  <div class="progress-bar" style="width: 25%">25%</div>
                </div>
              </td>
              <td>3m 05d</td>
            </tr>
            <tr>
              <td>3</td>
              <td>/produk</td>
              <td>1.800</td>
              <td>
                <div class="progress">
                  <div class="progress-bar" style="width: 21%">21%</div>
                </div>
              </td>
              <td>4m 00d</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Devices & Traffic -->
    <div class="row">
      <div class="col-md-6">
        <div class="section">
          <h3><i class="fas fa-mobile-alt me-2"></i>Perangkat Pengunjung</h3>
          <canvas id="deviceChart"></canvas>
        </div>
      </div>
      <div class="col-md-6">
        <div class="section">
          <h3><i class="fas fa-traffic-light me-2"></i>Sumber Trafik</h3>
          <div class="mt-3">
            <div class="d-flex justify-content-between mb-2">
              <span>Google</span>
              <span class="badge bg-success">45%</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Instagram</span>
              <span class="badge bg-success">25%</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Facebook</span>
              <span class="badge bg-success">15%</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Direct</span>
              <span class="badge bg-success">10%</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Lainnya</span>
              <span class="badge bg-success">5%</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Countries -->
    <div class="section">
      <h3><i class="fas fa-globe-asia me-2"></i>Asal Pengunjung</h3>
      <div class="row">
        <div class="col-md-6">
          <div class="country-item">
            <span>Indonesia</span>
            <span class="badge badge-traffic">45%</span>
          </div>
          <div class="country-item">
            <span>Malaysia</span>
            <span class="badge badge-traffic">25%</span>
          </div>
          <div class="country-item">
            <span>Singapura</span>
            <span class="badge badge-traffic">15%</span>
          </div>
        </div>
        <div class="col-md-6">
          <div id="map" style="height: 200px; background-color: #e8f5e9; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/57/BlankMap-World-v2.png/640px-BlankMap-World-v2.png" 
                 style="max-width: 100%; max-height: 100%;" 
                 alt="Peta Pengunjung">
          </div>
        </div>
      </div>
    </div>

    <!-- Export Options -->
    <div class="section text-center">
      <h3><i class="fas fa-download me-2"></i>Ekspor Laporan</h3>
      <div class="d-flex justify-content-center flex-wrap">
        <button onclick="downloadPDF()" class="btn btn-success mx-2 my-1">
          <i class="fas fa-file-pdf me-1"></i> Unduh PDF
        </button>
        <button onclick="exportCSV()" class="btn btn-outline-success mx-2 my-1">
          <i class="fas fa-file-csv me-1"></i> Export CSV
        </button>
        <button onclick="exportImage()" class="btn btn-outline-success mx-2 my-1">
          <i class="fas fa-image me-1"></i> Export Gambar
        </button>
      </div>
    </div>
  </div>

  <footer class="text-center">
    <div class="container">
      <p class="mb-2">
        <strong>GreenLeaf Analytics</strong> - Laporan Aktivitas Website
      </p>
      <p class="small text-muted">
        Dibuat dengan <i class="fas fa-heart text-danger"></i> oleh Tim GreenLeaf
        <br>
        Terakhir diperbarui: <span id="currentDate"></span>
      </p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>

  <script>
    // Set current date
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('id-ID', {
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric'
    });

    // Initialize charts
    const visitorChart = new Chart(document.getElementById('visitorChart'), {
      type: 'doughnut',
      data: {
        labels: ['Pengunjung Baru', 'Pengunjung Kembali'],
        datasets: [{
          data: [72, 28],
          backgroundColor: ['#2e7d32', '#81c784'],
          borderWidth: 0
        }]
      },
      options: { 
        plugins: { 
          legend: { 
            position: 'bottom',
            labels: {
              padding: 20
            }
          } 
        },
        cutout: '70%'
      }
    });

    const dailyChart = new Chart(document.getElementById('dailyChart'), {
      type: 'bar',
      data: {
        labels: ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'],
        datasets: [{
          label: 'Pengunjung',
          data: [1200, 1350, 1500, 1400, 1600, 1750, 1650],
          backgroundColor: '#2e7d32',
          borderRadius: 5
        }]
      },
      options: {
        responsive: true,
        plugins: { 
          legend: { display: false },
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              display: false
            }
          },
          x: {
            grid: {
              display: false
            }
          }
        }
      }
    });

    const deviceChart = new Chart(document.getElementById('deviceChart'), {
      type: 'pie',
      data: {
        labels: ['Mobile', 'Desktop', 'Tablet'],
        datasets: [{
          data: [62, 30, 8],
          backgroundColor: ['#2e7d32', '#81c784', '#a5d6a7'],
          borderWidth: 0
        }]
      },
      options: { 
        plugins: { 
          legend: { 
            position: 'bottom',
            labels: {
              padding: 20
            }
          } 
        }
      }
    });

    // Change chart type
    function changeChartType(chartId, type) {
      if (chartId === 'visitorChart') {
        visitorChart.config.type = type;
        visitorChart.update();
      } else if (chartId === 'dailyChart') {
        dailyChart.config.type = type;
        dailyChart.update();
      }
    }

    // Apply filter
    function applyFilter() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      
      // Simulate loading
      document.querySelectorAll('.summary-number').forEach(el => {
        el.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      });
      
      setTimeout(() => {
        // In a real app, you would fetch new data here
        alert(`Filter diterapkan untuk periode: ${startDate} hingga ${endDate}\n\n(Sebagai contoh, data tetap sama)`);
        
        // Reset numbers
        document.getElementById('visitors').textContent = '8.450';
        document.getElementById('views').textContent = '21.300';
        document.getElementById('duration').textContent = '3:42';
        document.getElementById('bounce').textContent = '42%';
      }, 1500);
    }

    // Download PDF
    function downloadPDF() {
      const element = document.getElementById('report-content');
      const opt = {
        margin: 10,
        filename: 'laporan-aktivitas-greenleaf.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      
      // Show loading
      const originalContent = element.innerHTML;
      element.innerHTML = '<div class="text-center py-5"><h3>Menyiapkan PDF...</h3><div class="spinner-border text-success" role="status"></div></div>';
      
      setTimeout(() => {
        html2pdf().set(opt).from(element).toPdf().get('pdf').then(function(pdf) {
          // Add footer
          const totalPages = pdf.internal.getNumberOfPages();
          for (let i = 1; i <= totalPages; i++) {
            pdf.setPage(i);
            pdf.setFontSize(10);
            pdf.setTextColor(150);
            pdf.text('Halaman ' + i + ' dari ' + totalPages, pdf.internal.pageSize.getWidth() - 30, pdf.internal.pageSize.getHeight() - 10);
          }
        }).save().then(() => {
          // Restore content
          element.innerHTML = originalContent;
        });
      }, 500);
    }

    // Export CSV
    function exportCSV() {
      const csvContent = "Data,Nilai\n" +
        "Total Pengunjung,8450\n" +
        "Total Halaman Dilihat,21300\n" +
        "Durasi Rata-rata,3:42\n" +
        "Rasio Pentalan,42%\n" +
        "Pengunjung Baru,72%\n" +
        "Pengunjung Kembali,28%";
      
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', 'laporan-greenleaf.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Export as Image
    function exportImage() {
      const element = document.getElementById('report-content');
      
      htmlToImage.toPng(element)
        .then(function (dataUrl) {
          const link = document.createElement('a');
          link.download = 'laporan-greenleaf.png';
          link.href = dataUrl;
          link.click();
        })
        .catch(function (error) {
          console.error('Error generating image:', error);
          alert('Gagal mengekspor gambar. Silakan coba lagi.');
        });
    }

    // Toggle dark mode
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      
      // Change button icon
      const btn = document.querySelector('[onclick="toggleDarkMode()"]');
      if (document.body.classList.contains('dark-mode')) {
        btn.innerHTML = '<i class="fas fa-sun"></i> Mode Terang';
      } else {
        btn.innerHTML = '<i class="fas fa-moon"></i> Mode Gelap';
      }
      
      // Update charts for dark mode
      updateChartsForDarkMode();
    }

    // Update charts when dark mode changes
    function updateChartsForDarkMode() {
      const isDarkMode = document.body.classList.contains('dark-mode');
      const textColor = isDarkMode ? '#e0e0e0' : '#666';
      const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
      
      // Update visitor chart
      visitorChart.options.plugins.legend.labels.color = textColor;
      
      // Update daily chart
      dailyChart.options.scales.x.ticks.color = textColor;
      dailyChart.options.scales.y.ticks.color = textColor;
      dailyChart.options.scales.x.grid.color = gridColor;
      dailyChart.options.scales.y.grid.color = gridColor;
      
      // Update device chart
      deviceChart.options.plugins.legend.labels.color = textColor;
      
      // Update all charts
      visitorChart.update();
      dailyChart.update();
      deviceChart.update();
    }

    // Initialize dark mode if preferred
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.body.classList.add('dark-mode');
      document.querySelector('[onclick="toggleDarkMode()"]').innerHTML = '<i class="fas fa-sun"></i> Mode Terang';
    }
  </script>
</body>
</html>